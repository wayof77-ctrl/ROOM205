<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROOM NO.205 (iframe lazy-load 최적화)</title>

<style>
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans KR", sans-serif; margin:0; padding:0; background:#f0f8ff; color:#333; }
nav { background:#1f3152; padding:10px 20px; position:sticky; top:0; z-index:1000; }
nav ul { list-style:none; margin:0; padding:0; display:inline-block; }
nav ul li { position:relative; display:inline-block; margin:0 15px; }
nav ul li a { color:white; text-decoration:none; padding:10px; display:block; font-weight:bold; }
nav ul li a:hover { background:#2a416a; }
nav ul li a.active { background:#007bff; border-radius:5px; }
nav ul ul { display:none; position:absolute; top:100%; left:0; background:#3e5072; padding:5px; min-width:220px; border-radius:5px; }
nav ul li:hover > ul { display:block; }
nav ul ul li { display:block; }
nav ul ul li:not(:last-child){ border-bottom:1px solid #5a6b8a; }
nav ul ul li a { padding:8px 12px; font-weight:normal; border-radius:3px; white-space:nowrap; }

section { padding:20px; display:none; }
#Home { display:block; }

.button-container { margin-bottom:20px; }
.currency-button { padding:0 15px; font-size:16px; background:#3e5072; color:white; border:none; border-radius:5px; cursor:pointer; margin-right:10px; height:40px; display:inline-flex; align-items:center; white-space:nowrap; }
.currency-button:hover { background:#2a416a; }
.currency-button.active { background:#007bff; }

.iframe-wrap{ position:relative; }
.loading-layer{
  position:absolute; inset:0; background:rgba(255,255,255,0.7);
  display:flex; align-items:center; justify-content:center;
  font-weight:bold; color:#1f3152; display:none;
}

iframe { width:100%; height:75vh; border:none; background:white; border-radius:6px; }

.modal { display:none; position:fixed; z-index:1001; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.4);} 
.modal-content { background:#fff; margin:15% auto; padding:20px; width:300px; border-radius:10px; text-align:center;}
.modal-content input { width:90%; padding:10px; margin:10px 0; }
.modal-content button { padding:10px 20px; border:none; background:#007bff; color:white; border-radius:5px; cursor:pointer; }
</style>
</head>

<body>

<nav>
<div style="float:right; display:flex; gap:10px;">
<button id="logout-btn" style="background:#c0392b;color:#fff;border:none;border-radius:5px;padding:8px 12px;cursor:pointer;">로그아웃</button>
<button id="logout-hard-btn" style="background:#7f8c8d;color:#fff;border:none;border-radius:5px;padding:8px 12px;cursor:pointer;">전체로그아웃</button>
</div>
<ul>
<li><a href="#Home" class="active">홈</a></li>
<li><a href="#index">지표</a><ul><li><a href="#currency">환율</a></li></ul></li>
<li><a href="#interest">관심종목</a><ul><li><a href="#etf">ETF</a></li><li><a href="#stock">종목</a></li></ul></li>
<li><a href="#holdings">보유자산</a><ul><li><a href="#asset-summary">자산요약</a></li><li><a href="#pension-assets">용_연금</a></li><li><a href="#isa">용_ISA</a></li><li><a href="#hope-pension">희_연금</a></li><li><a href="#hope-isa">희_ISA</a></li></ul></li>
</ul>
</nav>

<section id="Home"><h2>홈</h2></section>

<section id="currency">
<h2>환율</h2>
<div class="button-container">
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=1294907219&single=true">USD/KRW</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=1091372610&single=true">JPY/KRW</button>
</div>
<div class="iframe-wrap"><div class="loading-layer">Loading sheet…</div><iframe id="currency-frame" loading="lazy"></iframe></div>
</section>

<section id="etf">
<h2>ETF</h2>
<div class="button-container">
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=380505280&single=true">고배당</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=1965547780&single=true">미국ETF</button>
</div>
<div class="iframe-wrap"><div class="loading-layer">Loading sheet…</div><iframe id="etf-frame" loading="lazy"></iframe></div>
</section>

<section id="stock">
<h2>종목</h2>
<div class="button-container">
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=0&single=true">JYP Ent.</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=1090513306&single=true">바이오</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=1194545980&single=true">현대차</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=393814856&single=true">전력/송배전</button>
</div>
<div class="iframe-wrap"><div class="loading-layer">Loading sheet…</div><iframe id="stock-frame" loading="lazy"></iframe></div>
</section>

<section id="holdings">
<h2>보유 자산</h2>
<div class="button-container">
<button id="asset-summary-btn" class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=1364393695&single=true">자산요약</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=1093026752&single=true">용_연금</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=254624983&single=true">용_ISA</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=553919398&single=true">희_연금</button>
<button class="currency-button" data-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRtp718EeeOqVQWZ3SmFy1YLBpp1nq8GViM0GsJgqW9XLlB_G54x2jWxrWri0zd3CPjGfENNtP9SyoA/pubhtml?gid=228589855&single=true">희_ISA</button>
</div>
<div class="iframe-wrap"><div class="loading-layer">Loading sheet…</div><iframe id="holdings-frame" loading="lazy"></iframe></div>
</section>

<div id="password-modal" class="modal"><div class="modal-content"><p>비밀번호 입력</p><input type="password" id="password-input"><button id="password-submit">확인</button></div></div>
<div id="error-modal" class="modal"><div class="modal-content"><p>비밀번호 오류</p><button id="error-ok">확인</button></div></div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
// localStorage 인증 복원
window.__HOLDINGS_AUTH__ = localStorage.getItem('HOLDINGS_AUTH') === 'true';

// ===== 자동 세션 만료(10분 무활동) =====
const SESSION_TIMEOUT = 10 * 60 * 1000; // 10분
let __SESSION_TIMER__ = null;

function resetSessionTimer(){
  if(!window.__HOLDINGS_AUTH__) return;
  if(__SESSION_TIMER__) clearTimeout(__SESSION_TIMER__);
  __SESSION_TIMER__ = setTimeout(()=>{
    // 자동 로그아웃
    window.__HOLDINGS_AUTH__ = false;
    localStorage.removeItem('HOLDINGS_AUTH');
    if(__SESSION_TIMER__) clearTimeout(__SESSION_TIMER__);
    alert('10분간 활동이 없어 자동 로그아웃되었습니다');
    showSection('Home');
    setActiveNav(document.querySelector('a[href="#Home"]'));
  }, SESSION_TIMEOUT);
}

// 사용자 활동 감지 이벤트
['click','mousemove','keydown','scroll','touchstart'].forEach(evt=>{
  document.addEventListener(evt, resetSessionTimer, {passive:true});
});

// 최초 로드 시 세션 타이머 시작
if(window.__HOLDINGS_AUTH__){
  resetSessionTimer();
}
// =====================================
const navLinks=document.querySelectorAll('nav a');
const sections=document.querySelectorAll('section');

function showSection(id){ 
  sections.forEach(s=>s.style.display='none'); 
  const target=document.getElementById(id);
  if(target){ target.style.display='block'; }
}

function setActiveNav(active){ navLinks.forEach(l=>l.classList.remove('active')); active.classList.add('active'); }

function bindButtons(sectionId,frameId){
  const frame=document.getElementById(frameId);
  if(!frame) return;
  const wrap=frame.parentElement;
  const loader=wrap.querySelector('.loading-layer');
  const buttons=document.querySelectorAll(`#${sectionId} .currency-button`);
  buttons.forEach(btn=>{
    btn.addEventListener('click',()=>{
      buttons.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      if(loader) loader.style.display='flex';
      frame.src=btn.dataset.url;
    });
  });
  frame.addEventListener('load',()=>{ if(loader) loader.style.display='none'; });
}

bindButtons('currency','currency-frame');
bindButtons('etf','etf-frame');
bindButtons('stock','stock-frame');
bindButtons('holdings','holdings-frame');

navLinks.forEach(link=>{
  link.addEventListener('click',function(e){
    const href=this.getAttribute('href');
    if(!href.startsWith('#')) return;
    e.preventDefault();

    const target=href.replace('#','');

    // 보유자산 하위 메뉴 처리
    const holdingsPages=['holdings','asset-summary','pension-assets','isa','hope-pension','hope-isa'];
    if(holdingsPages.includes(target)){
      // 비밀번호 아직 안 풀린 경우
      if(!window.__HOLDINGS_AUTH__){
        window.__TARGET_HOLDINGS_PAGE__=target;
        passwordModal.style.display='block';
        return;
      } else{
        showSection('holdings');
        setActiveNav(document.querySelector('a[href="#holdings"]'));
        const map={
          'asset-summary':0,
          'pension-assets':1,
          'isa':2,
          'hope-pension':3,
          'hope-isa':4
        };
        const btns=document.querySelectorAll('#holdings .currency-button');
        const idx=map[target];
        if(btns[idx]) btns[idx].click();
        return;
      }
    }

    // 일반 섹션 이동
    if(document.getElementById(target)){
      showSection(target); 
      setActiveNav(this);
      const firstBtn=document.querySelector(`#${target} .currency-button`);
      if(firstBtn) firstBtn.click();
    }
  });
});
});

const passwordModal=document.getElementById('password-modal');
const passwordInput=document.getElementById('password-input');
const passwordSubmit=document.getElementById('password-submit');
const errorModal=document.getElementById('error-modal');
const errorOk=document.getElementById('error-ok');

// 보유자산 루트 메뉴 클릭 시
const holdingsLink=document.querySelector('a[href="#holdings"]');
if(holdingsLink){
  holdingsLink.addEventListener('click',()=>{
    if(!window.__HOLDINGS_AUTH__){
      window.__TARGET_HOLDINGS_PAGE__='asset-summary';
      passwordModal.style.display='block';
    } else{
      showSection('holdings');
      setActiveNav(holdingsLink);
      const btn=document.getElementById('asset-summary-btn');
      if(btn) btn.click();
    }
  });
});
}

passwordSubmit.addEventListener('click',()=>{
  if(passwordInput.value==="1114"){
    passwordModal.style.display='none';
    window.__HOLDINGS_AUTH__=true;
    localStorage.setItem('HOLDINGS_AUTH','true');
    resetSessionTimer();('click',()=>{
  if(passwordInput.value==="1114"){
    passwordModal.style.display='none';
    window.__HOLDINGS_AUTH__=true;
    const target=window.__TARGET_HOLDINGS_PAGE__||'asset-summary';
    showSection('holdings'); 
    setActiveNav(document.querySelector('a[href="#holdings"]'));
    const map={
      'asset-summary':0,
      'pension-assets':1,
      'isa':2,
      'hope-pension':3,
      'hope-isa':4
    };
    const btns=document.querySelectorAll('#holdings .currency-button');
    const idx=map[target];
    if(btns[idx]) btns[idx].click();
  } else{
    passwordModal.style.display='none'; 
    errorModal.style.display='block';
  }
});

// 로그아웃 버튼들
const logoutBtn=document.getElementById('logout-btn');
const logoutHardBtn=document.getElementById('logout-hard-btn');

if(logoutBtn){
  logoutBtn.addEventListener('click',()=>{
    window.__HOLDINGS_AUTH__=false;
    localStorage.removeItem('HOLDINGS_AUTH');
    alert('로그아웃 되었습니다');
    showSection('Home');
    setActiveNav(document.querySelector('a[href="#Home"]'));
  });
}

if(logoutHardBtn){
  logoutHardBtn.addEventListener('click',()=>{
    window.__HOLDINGS_AUTH__=false;
    localStorage.clear();
    if(__SESSION_TIMER__) clearTimeout(__SESSION_TIMER__);
    alert('전체 로그아웃 완료');
    location.reload();
  });
}

errorOk.addEventListener('click',()=>{ 
  errorModal.style.display='none'; 
  showSection('Home'); 
  setActiveNav(document.querySelector('a[href="#Home"]')); 
});
});
</script>
</body>
</html>
